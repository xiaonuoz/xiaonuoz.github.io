<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='gorm介绍 安装 1 go get -u github.com/jinzhu/gorm 连接数据库 连接不同的数据库都需要导入对应数据的驱动程序，GORM已经贴心的包装了一些驱动程序，只需要按如下方式导入'>
<title>GORM框架初识</title>

<link rel='canonical' href='https://xiaonuoz.github.io/p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/'>

<link rel="stylesheet" href="/scss/style.min.5470349c9ee04f592bc7c1dcd2e028072cd1dec2a37467ccfd4c5ecaf180dcaa.css"><meta property='og:title' content='GORM框架初识'>
<meta property='og:description' content='gorm介绍 安装 1 go get -u github.com/jinzhu/gorm 连接数据库 连接不同的数据库都需要导入对应数据的驱动程序，GORM已经贴心的包装了一些驱动程序，只需要按如下方式导入'>
<meta property='og:url' content='https://xiaonuoz.github.io/p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/'>
<meta property='og:site_name' content='笑傩'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2021-01-15T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2021-01-15T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="GORM框架初识">
<meta name="twitter:description" content="gorm介绍 安装 1 go get -u github.com/jinzhu/gorm 连接数据库 连接不同的数据库都需要导入对应数据的驱动程序，GORM已经贴心的包装了一些驱动程序，只需要按如下方式导入">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu89d70501dbd1e038dcbf309839bfe7a9_213951_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">笑傩</a></h1>
            <h2 class="site-description">永远不要高估自己~</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/xiaonuoz'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>暗色模式</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#gorm介绍">gorm介绍</a></li>
    <li><a href="#安装">安装</a></li>
    <li><a href="#连接数据库">连接数据库</a>
      <ol>
        <li><a href="#连接mysqldb最好定义为全局变量">连接MySQL（db最好定义为全局变量）</a></li>
        <li><a href="#连接postgresql">连接PostgreSQL</a></li>
        <li><a href="#连接sqlite3">连接Sqlite3</a></li>
        <li><a href="#连接sql-server">连接SQL Server</a></li>
      </ol>
    </li>
    <li><a href="#gorm基本示例">GORM基本示例</a>
      <ol>
        <li><a href="#gorm操作mysql">GORM操作MySQL</a></li>
      </ol>
    </li>
    <li><a href="#gorm-model定义">GORM Model定义</a>
      <ol>
        <li><a href="#gormmodel">gorm.Model</a></li>
        <li><a href="#模型定义示例">模型定义示例</a></li>
        <li><a href="#结构体标记tags">结构体标记（tags）</a>
          <ol>
            <li><a href="#支持的结构体标记struct-tags">支持的结构体标记（Struct tags）</a></li>
            <li><a href="#关联相关标记tags">关联相关标记（tags）</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#主键表名列名的约定">主键、表名、列名的约定</a>
      <ol>
        <li><a href="#主键primary-key">主键（Primary Key）</a></li>
        <li><a href="#表名table-name">表名（Table Name）</a></li>
        <li><a href="#列名column-name">列名（Column Name）</a></li>
        <li><a href="#时间戳跟踪">时间戳跟踪</a>
          <ol>
            <li><a href="#createdat">CreatedAt</a></li>
            <li><a href="#updatedat">UpdatedAt</a></li>
            <li><a href="#deletedat">DeletedAt</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#创建">创建</a>
      <ol>
        <li><a href="#创建记录">创建记录</a></li>
        <li><a href="#默认值">默认值</a>
          <ol>
            <li><a href="#使用指针方式实现零值存入数据库">使用指针方式实现零值存入数据库</a></li>
            <li><a href="#使用scannervaluer接口方式实现零值存入数据库">使用Scanner/Valuer接口方式实现零值存入数据库</a></li>
          </ol>
        </li>
        <li><a href="#扩展创建选项">扩展创建选项</a></li>
      </ol>
    </li>
    <li><a href="#查询">查询</a>
      <ol>
        <li><a href="#一般查询">一般查询</a></li>
        <li><a href="#where-条件">Where 条件</a>
          <ol>
            <li><a href="#普通sql查询">普通SQL查询</a></li>
            <li><a href="#struct--map查询">Struct &amp; Map查询</a></li>
          </ol>
        </li>
        <li><a href="#not-条件不等于">Not 条件（不等于）</a></li>
        <li><a href="#or条件">Or条件</a></li>
        <li><a href="#内联条件在立即执行方法中添加条件而不是使用where">内联条件(在立即执行方法中添加条件，而不是使用where)</a></li>
        <li><a href="#额外查询选项">额外查询选项</a></li>
        <li><a href="#firstorinit">FirstOrInit</a>
          <ol>
            <li><a href="#attrs">Attrs</a></li>
            <li><a href="#assign">Assign</a></li>
          </ol>
        </li>
        <li><a href="#firstorcreate">FirstOrCreate</a>
          <ol>
            <li><a href="#attrs-1">Attrs</a></li>
            <li><a href="#assign-1">Assign</a></li>
          </ol>
        </li>
        <li><a href="#高级查询">高级查询</a>
          <ol>
            <li><a href="#子查询">子查询</a></li>
            <li><a href="#选择字段">选择字段</a></li>
            <li><a href="#排序">排序</a></li>
            <li><a href="#数量">数量</a></li>
            <li><a href="#偏移">偏移</a></li>
            <li><a href="#总数">总数</a></li>
            <li><a href="#后端分页">后端分页</a></li>
            <li><a href="#一对多查询-预加载preload">一对多查询-预加载Preload</a></li>
            <li><a href="#嵌套预加载preload">嵌套预加载Preload</a></li>
            <li><a href="#group--having">Group &amp; Having</a></li>
            <li><a href="#连接">连接</a></li>
          </ol>
        </li>
        <li><a href="#pluck">Pluck</a></li>
        <li><a href="#扫描">扫描</a></li>
      </ol>
    </li>
    <li><a href="#链式操作相关">链式操作相关</a>
      <ol>
        <li><a href="#链式操作">链式操作</a></li>
        <li><a href="#立即执行方法">立即执行方法</a></li>
        <li><a href="#范围">范围</a></li>
        <li><a href="#多个立即执行方法">多个立即执行方法</a></li>
      </ol>
    </li>
    <li><a href="#更新">更新</a>
      <ol>
        <li><a href="#更新所有字段">更新所有字段</a></li>
        <li><a href="#更新修改字段">更新修改字段</a></li>
        <li><a href="#更新选定字段">更新选定字段</a></li>
        <li><a href="#无hooks更新指定单一或多个字段更新不更新钩子函数">无Hooks更新(指定单一或多个字段更新，不更新钩子函数)</a></li>
        <li><a href="#批量更新">批量更新</a></li>
        <li><a href="#使用sql表达式更新">使用SQL表达式更新</a></li>
        <li><a href="#修改hooks中的值">修改Hooks中的值</a></li>
        <li><a href="#其它更新选项针对sql-server">其它更新选项(针对SQL Server)</a></li>
      </ol>
    </li>
    <li><a href="#删除">删除</a>
      <ol>
        <li><a href="#删除记录只针对通过id主键进行删除">删除记录（只针对通过ID主键进行删除）</a></li>
        <li><a href="#批量删除">批量删除</a></li>
        <li><a href="#软删除当没有使用gormmodel构建结构体时删除直接就是物理删除">软删除（当没有使用gorm.Model构建结构体时，删除直接就是物理删除）</a></li>
        <li><a href="#物理删除用gormmodel构建结构体时">物理删除（用gorm.Model构建结构体时）</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/golang/" >
                golang
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/">GORM框架初识</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 15, 2021</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="gorm介绍">gorm介绍</h2>
<h2 id="安装">安装</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get -u github.com/jinzhu/gorm
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="连接数据库">连接数据库</h2>
<p>连接不同的数据库都需要导入对应数据的驱动程序，<code>GORM</code>已经贴心的包装了一些驱动程序，只需要按如下方式导入需要的数据库驱动即可：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nx">_</span> <span class="s">&#34;github.com/jinzhu/gorm/dialects/mysql&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// import _ &#34;github.com/jinzhu/gorm/dialects/postgres&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">// import _ &#34;github.com/jinzhu/gorm/dialects/sqlite&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">// import _ &#34;github.com/jinzhu/gorm/dialects/mssql&#34;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="连接mysqldb最好定义为全局变量">连接MySQL（db最好定义为全局变量）</h3>
<p>db定义为全局变量的原因首先是避免重复生成新的连接，并且db本身就代表orm的一个连接池句柄了，其他地方可以直接通过db.  来操作数据库 [redigo中通过初始化连接池然后Get()获取池里面的连接，这里db就是一个连接池，调用db的方法默认会从池中抽取一个连接来使用，使用完默认自动放回去] ，所以在定义全局的db后最好不要再close()掉db了，让它随程序的存在而存在，程序停止则池子停止。</p>
<p>db连接池默认空闲数好像是5，可以通过DB().SetMaxIdleConns()来设置最大空闲数，通过SetMaxOpenConns()设置最大连接数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;github.com/jinzhu/gorm&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_</span> <span class="s">&#34;github.com/jinzhu/gorm/dialects/mysql&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="c1">//parseTime 将数据中包含时间类型的解析成数据库时间类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">gorm</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;mysql&#34;</span><span class="p">,</span> <span class="s">&#34;user:password@(localhost:port)/dbname?charset=utf8mb4&amp;parseTime=True&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//defer db.Close()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="连接postgresql">连接PostgreSQL</h3>
<p>基本代码同上，注意引入对应 <code>postgres</code>驱动并正确指定 <code>gorm.Open()</code>参数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;github.com/jinzhu/gorm&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_</span> <span class="s">&#34;github.com/jinzhu/gorm/dialects/postgres&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">gorm</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;postgres&#34;</span><span class="p">,</span> <span class="s">&#34;host=myhost port=myport user=gorm dbname=gorm password=mypassword&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">defer</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="连接sqlite3">连接Sqlite3</h3>
<p>基本代码同上，注意引入对应 <code>sqlite</code>驱动并正确指定 <code>gorm.Open()</code>参数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;github.com/jinzhu/gorm&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_</span> <span class="s">&#34;github.com/jinzhu/gorm/dialects/sqlite&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">gorm</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;sqlite3&#34;</span><span class="p">,</span> <span class="s">&#34;/tmp/gorm.db&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">defer</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="连接sql-server">连接SQL Server</h3>
<p>基本代码同上，注意引入对应 <code>mssql</code>驱动并正确指定 <code>gorm.Open()</code>参数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;github.com/jinzhu/gorm&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_</span> <span class="s">&#34;github.com/jinzhu/gorm/dialects/mssql&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">gorm</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;mssql&#34;</span><span class="p">,</span> <span class="s">&#34;sqlserver://username:password@localhost:1433?database=dbname&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">defer</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="gorm基本示例">GORM基本示例</h2>
<h3 id="gorm操作mysql">GORM操作MySQL</h3>
<p>使用GORM连接上面的 <code>db1</code>进行创建、查询、更新、删除操作。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/jinzhu/gorm&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span> <span class="s">&#34;github.com/jinzhu/gorm/dialects/mysql&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// UserInfo 用户信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">UserInfo</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ID</span> <span class="kt">uint</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Gender</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Hobby</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">db</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">initMysql</span><span class="p">()(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">gorm</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;mysql&#34;</span><span class="p">,</span> <span class="s">&#34;user:password@(localhost:port)/dbname?charset=utf8mb4&amp;parseTime=True&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nf">initMysql</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//结构体名和成员名必须大写，否则在AutoMigrate函数中无法对其成员值进行修改
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//自动创建数据库表（它会将结构体和数据库表进行对应，对名称进行解析，两个单词之间用下划线分割，且加上复数，即user_infos）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//此方法对给定的模型进行自动迁移，只会添加缺失的字段，不会删除/更改当前数据，当表存在也添加此方法，将结构体与数据库中的表进行关联,结构体与表不对应则会添加字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">db</span><span class="p">.</span><span class="nf">AutoMigrate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">UserInfo</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//添加数据, mysql无法添加切片类型数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//结构体对象比较大，建议传指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">u</span><span class="o">:=</span><span class="nx">UserInfo</span><span class="p">{</span><span class="nx">Id</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;笑傩&#34;</span><span class="p">,</span><span class="nx">Gender</span><span class="p">:</span> <span class="s">&#34;男&#34;</span><span class="p">,</span><span class="nx">Hobby</span><span class="p">:</span> <span class="s">&#34;篮球&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">db</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//查询数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">u</span><span class="o">:=</span><span class="nx">UserInfo</span><span class="p">{</span><span class="nx">Id</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">db</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">uu</span> <span class="nx">UserInfo</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//根据条件查询
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">db</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">uu</span><span class="p">,</span> <span class="s">&#34;hobby=?&#34;</span><span class="p">,</span> <span class="s">&#34;足球&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%#v\n&#34;</span><span class="p">,</span> <span class="nx">uu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//更新数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">).</span><span class="nf">Update</span><span class="p">(</span><span class="s">&#34;hobby=?&#34;</span><span class="p">,</span><span class="s">&#34;足球&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">////删除数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">db</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>要注意的是db.AutoMigrate()用于与数据库表进行同步，如果不需要同步，仅仅是绑定的话，可以使用 <code>db.Model(&amp;User{})</code>，Model 指定你想运行db操作的模型，它不会因为结构体的新增改变数据库结构，仅绑定。</strong></p>
<h2 id="gorm-model定义">GORM Model定义</h2>
<p>在使用ORM工具时，通常我们需要在代码中定义模型（Models）与数据库中的数据表进行映射，在GORM中模型（Models）通常是正常定义的结构体、基本的go类型或它们的指针。 同时也支持 <code>sql.Scanner</code>及 <code>driver.Valuer</code>接口（interfaces）。</p>
<h3 id="gormmodel">gorm.Model</h3>
<p>为了方便模型定义，GORM内置了一个 <code>gorm.Model</code>结构体。<code>gorm.Model</code>是一个包含了 <code>ID</code>, <code>CreatedAt</code>, <code>UpdatedAt</code>, <code>DeletedAt</code>四个字段的Golang结构体。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// gorm.Model 定义
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Model</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ID</span>        <span class="kt">uint</span> <span class="s">`gorm:&#34;primary_key&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">CreatedAt</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
</span></span><span class="line"><span class="cl">  <span class="nx">UpdatedAt</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
</span></span><span class="line"><span class="cl">  <span class="nx">DeletedAt</span> <span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以将它嵌入到自己设置的模型中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 将 `ID`, `CreatedAt`, `UpdatedAt`, `DeletedAt`字段注入到`User`模型中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">gorm</span><span class="p">.</span><span class="nx">Model</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然也可以完全自己定义模型：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 不使用gorm.Model，自行定义模型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ID</span>   <span class="kt">int</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="模型定义示例">模型定义示例</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">gorm</span><span class="p">.</span><span class="nx">Model</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Age</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">NullInt64</span>	<span class="c1">//零值类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Birthday</span> <span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Email</span> <span class="kt">string</span> <span class="s">`gorm:&#34;type:varchar(100);unique_index&#34;`</span>	<span class="c1">//type设置字段类型。unique_index 建立一个唯一的索引
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Role</span> <span class="kt">string</span>	<span class="s">`gorm:&#34;size:255&#34;`</span>	<span class="c1">//设置字段大小为255
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//默认情况下，所有字段的零值, 比如 0, &#39;&#39;, false 或者其它 零值，都不会保存到数据库内，使用指针可以避免这种情况。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//例如我给某字段赋予一个默认的零值，此时这个值并不会保存到数据库，而是使用数据库设定的默认值。当使用指针时，指针是一个十六位数，可以顺利存进去
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">MemberNumber</span> <span class="o">*</span><span class="kt">string</span> <span class="s">`gorm:&#34;unique;not null&#34;`</span>	<span class="c1">//设置会员号唯一并且不能为空
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Num</span> <span class="kt">int</span> <span class="s">`gorm:&#34;AUTO_INCREMENT&#34;`</span>		<span class="c1">//设置num为自增类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Address</span> <span class="kt">string</span>	<span class="s">`gorm:&#34;index:addr&#34;`</span> 	<span class="c1">//给address字段创建名为addr的索引
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">IgnoreMe</span> 	<span class="kt">int</span> <span class="s">`gorm:&#34;-&#34;`</span>	<span class="c1">//忽略本字段，即该字段不会体现在数据库中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="结构体标记tags">结构体标记（tags）</h3>
<p>使用结构体声明模型时，标记（tags）是可选项。gorm支持以下标记:</p>
<h4 id="支持的结构体标记struct-tags">支持的结构体标记（Struct tags）</h4>
<p><img src="/p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/media/image.png"
	width="802"
	height="572"
	srcset="/p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/media/image_hu4d3c6f5a1f436e8198be753eefcb763d_44136_480x0_resize_box_3.png 480w, /p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/media/image_hu4d3c6f5a1f436e8198be753eefcb763d_44136_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image.png"
	
	
		class="gallery-image" 
		data-flex-grow="140"
		data-flex-basis="336px"
	
></p>
<h4 id="关联相关标记tags">关联相关标记（tags）</h4>
<p><img src="/p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/media/image-1.png"
	width="802"
	height="494"
	srcset="/p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/media/image-1_huff6c0833e9ac7b86d300636227692f12_46313_480x0_resize_box_3.png 480w, /p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/media/image-1_huff6c0833e9ac7b86d300636227692f12_46313_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image.png"
	
	
		class="gallery-image" 
		data-flex-grow="162"
		data-flex-basis="389px"
	
></p>
<h2 id="主键表名列名的约定">主键、表名、列名的约定</h2>
<h3 id="主键primary-key">主键（Primary Key）</h3>
<p>GORM 默认会使用名为ID的字段作为表的主键。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ID</span>   <span class="kt">string</span> <span class="c1">// 名为`ID`的字段会默认作为表的主键
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">Name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 使用`AnimalID`作为主键
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Animal</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">AnimalID</span> <span class="kt">int64</span> <span class="s">`gorm:&#34;primary_key&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Name</span>     <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Age</span>      <span class="kt">int64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="表名table-name">表名（Table Name）</h3>
<p>表名默认就是结构体名称的复数，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{}</span> <span class="c1">// 默认表名是 `users`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 将 User 的表名设置为 `profiles`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">User</span><span class="p">)</span> <span class="nf">TableName</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="s">&#34;profiles&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 也可以在设置表名时进行判断
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">u</span> <span class="nx">User</span><span class="p">)</span> <span class="nf">TableName</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">u</span><span class="p">.</span><span class="nx">Role</span> <span class="o">==</span> <span class="s">&#34;admin&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s">&#34;admin_users&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s">&#34;users&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 禁用默认表名的复数形式，如果置为 true，则 `User` 的默认表名是 `user`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">SingularTable</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>也可以通过 <code>Table()</code>指定表名：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 使用User结构体创建名为`deleted_users`的表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;deleted_users&#34;</span><span class="p">).</span><span class="nf">CreateTable</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">deleted_users</span> <span class="p">[]</span><span class="nx">User</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;deleted_users&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">deleted_users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM deleted_users;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;deleted_users&#34;</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name = ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">).</span><span class="nf">Delete</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// DELETE FROM deleted_users WHERE name = &#39;jinzhu&#39;;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>GORM还支持更改默认表名称规则：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">//每次执行创建语句之前会执行此函数，在每个表之前增加前缀
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DefaultTableNameHandler</span> <span class="p">=</span> <span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span><span class="p">,</span> <span class="nx">defaultTableName</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="s">&#34;prefix_&#34;</span> <span class="o">+</span> <span class="nx">defaultTableName</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="列名column-name">列名（Column Name）</h3>
<p>列名由字段名称进行下划线分割来生成</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ID</span>        <span class="kt">uint</span>      <span class="c1">// column name is `id`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">Name</span>      <span class="kt">string</span>    <span class="c1">// column name is `name`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">Birthday</span>  <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span> <span class="c1">// column name is `birthday`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">CreatedAt</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span> <span class="c1">// column name is `created_at`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以使用结构体tag指定列名：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Animal</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">AnimalId</span>    <span class="kt">int64</span>     <span class="s">`gorm:&#34;column:beast_id&#34;`</span>         <span class="c1">// set column name to `beast_id`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">Birthday</span>    <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span> <span class="s">`gorm:&#34;column:day_of_the_beast&#34;`</span> <span class="c1">// set column name to `day_of_the_beast`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">Age</span>         <span class="kt">int64</span>     <span class="s">`gorm:&#34;column:age_of_the_beast&#34;`</span> <span class="c1">// set column name to `age_of_the_beast`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="时间戳跟踪">时间戳跟踪</h3>
<h4 id="createdat">CreatedAt</h4>
<p>如果模型有 <code>CreatedAt</code>字段，该字段的值将会是初次创建记录的时间。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span> <span class="c1">// `CreatedAt`将会是当前时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 可以使用`Update`方法来改变`CreateAt`的值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Update</span><span class="p">(</span><span class="s">&#34;CreatedAt&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="updatedat">UpdatedAt</h4>
<p>如果模型有 <code>UpdatedAt</code>字段，该字段的值将会是每次更新记录的时间。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Save</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span> <span class="c1">// `UpdatedAt`将会是当前时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Update</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">)</span> <span class="c1">// `UpdatedAt`将会是当前时间
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="deletedat">DeletedAt</h4>
<p>如果模型有 <code>DeletedAt</code>字段，调用 <code>Delete</code>删除该记录时，<strong>将会设置 <code>DeletedAt</code>字段为当前时间，而不是直接将记录从数据库中删除（软删除）</strong>。删除后，无论查询还是修改都无法查询到该行数据了</p>
<h1 id="crud">CRUD</h1>
<h2 id="创建">创建</h2>
<h3 id="创建记录">创建记录</h3>
<p>首先定义模型：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ID</span>           <span class="kt">int64</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span>         <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Age</span>          <span class="kt">int64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用使用 <code>NewRecord()</code>查询主键是否存在，主键为空使用 <code>Create()</code>创建记录：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl">	<span class="nx">u</span><span class="o">:=</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;笑傩&#34;</span><span class="p">,</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">18</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">db</span><span class="p">.</span><span class="nf">NewRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">))</span>	<span class="c1">//如果自己设置主键的值，此方法是判断是否存在相同的主键值,不存在则返回true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">db</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">db</span><span class="p">.</span><span class="nf">NewRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">))</span>	<span class="c1">//这个fmt返回的是false，因为当创建后，u实例获取到了数据库中ID的值，此值在数据库中存在，所以返回false
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>成员首字母一定要大写，不然无法创建对应的字段！！</strong></p>
<h3 id="默认值">默认值</h3>
<p>可以通过 tag 定义字段的默认值，比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ID</span>   <span class="kt">int64</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Name</span> <span class="kt">string</span> <span class="s">`gorm:&#34;default:&#39;小王子&#39;&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Age</span>  <span class="kt">int64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>注意：<strong>通过tag定义字段的默认值，<strong>在创建记录时候生成的 SQL 语句会排除没有值或值为 零值 的字段</strong>(即insert时不设置字段为对应的零值，取决于数据库设置的默认值)。 在将记录插入到数据库后，Gorm会从数据库加载那些字段的默认值。</strong>（tag一定要在第一次建表时就设置好，因为当表建好后再设置默认值是无效的，数据库此时对应字段已经设置为了默认的NULL，它无法进行自动迁移）</strong></p>
<p>举个例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">user</span> <span class="p">=</span> <span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="s">&#34;&#34;</span><span class="p">,</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">18</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Debug</span><span class="p">().</span><span class="nf">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>	<span class="c1">//Debug()：在进行增删改查操作时会在终端打印出操作语句
</span></span></span><span class="line"><span class="cl"><span class="c1">//INSERT INTO `users` (`age`) VALUES (18)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上面代码实际执行的SQL语句是 <code>INSERT INTO users(&quot;age&quot;) values('99');</code>，排除了零值字段 <code>Name</code>，而在数据库中这一条数据会使用tag设置的默认值作为Name字段的值。</p>
<p>**注意：**所有字段的零值, 比如 <code>0</code>, <code>&quot;&quot;</code>,<code>false</code>或者其它 <code>零值</code>，都不会保存到数据库内，但会使用他们数据库中的默认值。 如果你想避免这种情况，可以考虑使用指针或实现 <code>Scanner/Valuer</code>接口，比如：</p>
<h4 id="使用指针方式实现零值存入数据库">使用指针方式实现零值存入数据库</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 使用指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ID</span>   <span class="kt">int64</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Name</span> <span class="o">*</span><span class="kt">string</span> <span class="s">`gorm:&#34;default:&#39;笑傩&#39;&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Age</span>  <span class="kt">int64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">user</span> <span class="o">:=</span> <span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="nb">new</span><span class="p">(</span><span class="kt">string</span><span class="p">),</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">18</span><span class="p">))}</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>  <span class="c1">// 此时数据库中该条记录name字段的值就是&#39;&#39;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="使用scannervaluer接口方式实现零值存入数据库">使用Scanner/Valuer接口方式实现零值存入数据库</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 使用 Scanner/Valuer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ID</span> <span class="kt">int64</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">NullString</span> <span class="s">`gorm:&#34;default:&#39;笑傩&#39;&#34;`</span> <span class="c1">// sql.NullString 实现了Scanner/Valuer接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Age</span>  <span class="kt">int64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">user</span> <span class="o">:=</span> <span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">NullString</span><span class="p">{</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kc">true</span><span class="p">},</span> <span class="nx">Age</span><span class="p">:</span><span class="mi">18</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>  <span class="c1">// 此时数据库中该条记录name字段的值就是&#39;&#39;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="扩展创建选项">扩展创建选项</h3>
<p>例如 <code>PostgreSQL</code>数据库中可以使用下面的方式实现合并插入, 有则更新, 无则插入。只针对PostgreSQL</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 为Instert语句添加扩展SQL选项
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;gorm:insert_option&#34;</span><span class="p">,</span> <span class="s">&#34;ON CONFLICT&#34;</span><span class="p">).</span><span class="nf">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">product</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// INSERT INTO products (name, code) VALUES (&#34;name&#34;, &#34;code&#34;) ON CONFLICT;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="查询">查询</h2>
<h3 id="一般查询">一般查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 根据主键查询第一条记录，仅当主键为整型时可用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users ORDER BY userId LIMIT 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 随机获取一条记录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Take</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users LIMIT 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 根据主键查询最后一条记录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Last</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users ORDER BY id DESC LIMIT 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 查询所有的记录，users是一个切片，用切片承载查询出来的结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="where-条件">Where 条件</h3>
<h4 id="普通sql查询">普通SQL查询</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Get first matched record
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name = ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">).</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#39;jinzhu&#39; limit 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Get all matched records
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name = ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#39;jinzhu&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// &lt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name &lt;&gt; ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name &lt;&gt; &#39;jinzhu&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// IN
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name IN (?)&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;jinzhu&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu 2&#34;</span><span class="p">}).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name in (&#39;jinzhu&#39;,&#39;jinzhu 2&#39;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// LIKE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name LIKE ?&#34;</span><span class="p">,</span> <span class="s">&#34;%jin%&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name LIKE &#39;%jin%&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// AND
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name = ? AND age &gt;= ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">,</span> <span class="s">&#34;22&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#39;jinzhu&#39; AND age &gt;= 22;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Time
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;updated_at &gt; ?&#34;</span><span class="p">,</span> <span class="nx">lastWeek</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE updated_at &gt; &#39;2000-01-01 00:00:00&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// BETWEEN
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;created_at BETWEEN ? AND ?&#34;</span><span class="p">,</span> <span class="nx">lastWeek</span><span class="p">,</span> <span class="nx">today</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE created_at BETWEEN &#39;2000-01-01 00:00:00&#39; AND &#39;2000-01-08 00:00:00&#39;;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="struct--map查询">Struct &amp; Map查询</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Struct
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">20</span><span class="p">}).</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#34;jinzhu&#34; AND age = 20 LIMIT 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Map
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">,</span> <span class="s">&#34;age&#34;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#34;jinzhu&#34; AND age = 20;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 主键的切片
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">([]</span><span class="kt">int64</span><span class="p">{</span><span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">}).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE id IN (20, 21, 22);
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>**提示：**当通过结构体进行查询时，GORM将会只通过非零值字段查询，这意味着如果你的字段值为 <code>0</code>，<code>''</code>，<code>false</code>或者其他 <code>零值</code>时，将不会被用于构建查询条件，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">0</span><span class="p">}).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#34;jinzhu&#34;;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>你可以使用指针或实现 Scanner/Valuer 接口来避免这个问题.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 使用指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">gorm</span><span class="p">.</span><span class="nx">Model</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Age</span>  <span class="o">*</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 使用 Scanner/Valuer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">gorm</span><span class="p">.</span><span class="nx">Model</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Age</span>  <span class="nx">sql</span><span class="p">.</span><span class="nx">NullInt64</span>  <span class="c1">// sql.NullInt64 实现了 Scanner/Valuer 接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="not-条件不等于">Not 条件（不等于）</h3>
<p>作用与 Where 类似的情形如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Not</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">).</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name &lt;&gt; &#34;jinzhu&#34; LIMIT 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Not In
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Not</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;jinzhu&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu 2&#34;</span><span class="p">}).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name NOT IN (&#34;jinzhu&#34;, &#34;jinzhu 2&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Not In slice of primary keys
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Not</span><span class="p">([]</span><span class="kt">int64</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}).</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE id NOT IN (1,2,3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Not</span><span class="p">([]</span><span class="kt">int64</span><span class="p">{}).</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Plain SQL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Not</span><span class="p">(</span><span class="s">&#34;name = ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">).</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE NOT(name = &#34;jinzhu&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Struct
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Not</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">}).</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name &lt;&gt; &#34;jinzhu&#34;;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="or条件">Or条件</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;role = ?&#34;</span><span class="p">,</span> <span class="s">&#34;admin&#34;</span><span class="p">).</span><span class="nf">Or</span><span class="p">(</span><span class="s">&#34;role = ?&#34;</span><span class="p">,</span> <span class="s">&#34;super_admin&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE role = &#39;admin&#39; OR role = &#39;super_admin&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Struct
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name = &#39;jinzhu&#39;&#34;</span><span class="p">).</span><span class="nf">Or</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;jinzhu 2&#34;</span><span class="p">}).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#39;jinzhu&#39; OR name = &#39;jinzhu 2&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Map
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name = &#39;jinzhu&#39;&#34;</span><span class="p">).</span><span class="nf">Or</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;jinzhu 2&#34;</span><span class="p">}).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#39;jinzhu&#39; OR name = &#39;jinzhu 2&#39;;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="内联条件在立即执行方法中添加条件而不是使用where">内联条件(在立即执行方法中添加条件，而不是使用where)</h3>
<p>作用与 <code>Where</code>查询类似，当内联条件与多个<a class="link" href="https://xiaonuo.top/articles/2021/02/22/1613984221164.html#toc_h3_58"  target="_blank" rel="noopener"
    >立即执行方法</a>一起使用时, <strong>内联条件不会传递给后面的立即执行方法（即只有当前立即执行方法可以使用，后面的立即执行方法是无法复用当前方法的内联条件的）</strong>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 根据主键获取记录 (只适用于整形主键)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE id = 23 LIMIT 1;
</span></span></span><span class="line"><span class="cl"><span class="c1">// 根据主键获取记录, 如果它是一个非整形主键
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">,</span> <span class="s">&#34;id = ?&#34;</span><span class="p">,</span> <span class="s">&#34;string_primary_key&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE id = &#39;string_primary_key&#39; LIMIT 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Plain SQL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">,</span> <span class="s">&#34;name = ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#34;jinzhu&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">,</span> <span class="s">&#34;name &lt;&gt; ? AND age &gt; ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name &lt;&gt; &#34;jinzhu&#34; AND age &gt; 20;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Struct
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">,</span> <span class="nx">User</span><span class="p">{</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE age = 20;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Map
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">,</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&#34;age&#34;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE age = 20;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="额外查询选项">额外查询选项</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 为查询 SQL 添加额外的 SQL 操作
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;gorm:query_option&#34;</span><span class="p">,</span> <span class="s">&#34;FOR UPDATE&#34;</span><span class="p">).</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE id = 10 FOR UPDATE;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="firstorinit">FirstOrInit</h3>
<p>获取匹配的第一条记录，否则根据给定的条件初始化一个新的对象 (仅支持 struct 和 map 条件)（<strong>注意：这个仅仅是初始化一个新的实例，并不会入库到数据库，不会入库到数据库！！！</strong>）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 未找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">FirstOrInit</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">,</span> <span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;non_existing&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Name: &#34;non_existing&#34;}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;Jinzhu&#34;</span><span class="p">}).</span><span class="nf">FirstOrInit</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Id: 111, Name: &#34;Jinzhu&#34;, Age: 20}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">FirstOrInit</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">,</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Id: 111, Name: &#34;Jinzhu&#34;, Age: 20}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="attrs">Attrs</h4>
<p>如果记录未找到，将使用参数初始化 struct.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 未找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;non_existing&#34;</span><span class="p">}).</span><span class="nf">Attrs</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">20</span><span class="p">}).</span><span class="nf">FirstOrInit</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM USERS WHERE name = &#39;non_existing&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Name: &#34;non_existing&#34;, Age: 20}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;non_existing&#34;</span><span class="p">}).</span><span class="nf">Attrs</span><span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">,</span> <span class="mi">20</span><span class="p">).</span><span class="nf">FirstOrInit</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM USERS WHERE name = &#39;non_existing&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Name: &#34;non_existing&#34;, Age: 20}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;Jinzhu&#34;</span><span class="p">}).</span><span class="nf">Attrs</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">30</span><span class="p">}).</span><span class="nf">FirstOrInit</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM USERS WHERE name = jinzhu&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Id: 111, Name: &#34;Jinzhu&#34;, Age: 20}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="assign">Assign</h4>
<p>不管记录是否找到，都将参数赋值给 struct.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 未找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;non_existing&#34;</span><span class="p">}).</span><span class="nf">Assign</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">20</span><span class="p">}).</span><span class="nf">FirstOrInit</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Name: &#34;non_existing&#34;, Age: 20}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;Jinzhu&#34;</span><span class="p">}).</span><span class="nf">Assign</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">30</span><span class="p">}).</span><span class="nf">FirstOrInit</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM USERS WHERE name = jinzhu&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Id: 111, Name: &#34;Jinzhu&#34;, Age: 30}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="firstorcreate">FirstOrCreate</h3>
<p>获取匹配的第一条记录, 否则根据给定的条件创建一个新的记录 (仅支持 struct 和 map 条件)（要入库到数据库中）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 未找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">FirstOrCreate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">,</span> <span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;non_existing&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// INSERT INTO &#34;users&#34; (name) VALUES (&#34;non_existing&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Id: 112, Name: &#34;non_existing&#34;}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;Jinzhu&#34;</span><span class="p">}).</span><span class="nf">FirstOrCreate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Id: 111, Name: &#34;Jinzhu&#34;}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="attrs-1">Attrs</h4>
<p>如果记录未找到，将使用参数创建 struct 和记录.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"> <span class="c1">// 未找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;non_existing&#34;</span><span class="p">}).</span><span class="nf">Attrs</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">20</span><span class="p">}).</span><span class="nf">FirstOrCreate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#39;non_existing&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//// INSERT INTO &#34;users&#34; (name, age) VALUES (&#34;non_existing&#34;, 20);
</span></span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Id: 112, Name: &#34;non_existing&#34;, Age: 20}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">}).</span><span class="nf">Attrs</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">30</span><span class="p">}).</span><span class="nf">FirstOrCreate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#39;jinzhu&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Id: 111, Name: &#34;jinzhu&#34;, Age: 20}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="assign-1">Assign</h4>
<p>不管记录是否找到，都将参数赋值给 struct 并保存至数据库.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 未找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;non_existing&#34;</span><span class="p">}).</span><span class="nf">Assign</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">20</span><span class="p">}).</span><span class="nf">FirstOrCreate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#39;non_existing&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//// INSERT INTO &#34;users&#34; (name, age) VALUES (&#34;non_existing&#34;, 20);
</span></span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Id: 112, Name: &#34;non_existing&#34;, Age: 20}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 找到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">}).</span><span class="nf">Assign</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">30</span><span class="p">}).</span><span class="nf">FirstOrCreate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE name = &#39;jinzhu&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET age=30 WHERE id = 111;
</span></span></span><span class="line"><span class="cl"><span class="c1">//// user -&gt; User{Id: 111, Name: &#34;jinzhu&#34;, Age: 30}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="高级查询">高级查询</h3>
<h4 id="子查询">子查询</h4>
<p>基于 <code>*gorm.expr</code> 的子查询</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;amount &gt; ?&#34;</span><span class="p">,</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;orders&#34;</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;AVG(amount)&#34;</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;state = ?&#34;</span><span class="p">,</span> <span class="s">&#34;paid&#34;</span><span class="p">).</span><span class="nf">SubQuery</span><span class="p">()).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">orders</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// SELECT * FROM &#34;orders&#34;  WHERE &#34;orders&#34;.&#34;deleted_at&#34; IS NULL AND (amount &gt; (SELECT AVG(amount) FROM &#34;orders&#34;  WHERE (state = &#39;paid&#39;)));
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="选择字段">选择字段</h4>
<p>Select，指定你想从数据库中检索出的字段，默认会选择全部字段。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;name, age&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT name, age FROM users;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Select</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;age&#34;</span><span class="p">}).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT name, age FROM users;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;users&#34;</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;COALESCE(age,?)&#34;</span><span class="p">,</span> <span class="mi">42</span><span class="p">).</span><span class="nf">Rows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT COALESCE(age,&#39;42&#39;) FROM users;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="排序">排序</h4>
<p>Order，指定从数据库中检索出记录的顺序。设置第二个参数 reorder 为 <code>true</code> ，可以覆盖前面定义的排序条件（不加则是在原来的基础上继续排序）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Order</span><span class="p">(</span><span class="s">&#34;age desc, name&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users ORDER BY age desc, name;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 多字段排序
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Order</span><span class="p">(</span><span class="s">&#34;age desc&#34;</span><span class="p">).</span><span class="nf">Order</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users ORDER BY age desc, name;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 覆盖排序
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Order</span><span class="p">(</span><span class="s">&#34;age desc&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users1</span><span class="p">).</span><span class="nf">Order</span><span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">,</span> <span class="kc">true</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users ORDER BY age desc; (users1)
</span></span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users ORDER BY age; (users2)
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="数量">数量</h4>
<p>Limit，指定从数据库检索出的最大记录数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Limit</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users LIMIT 3;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// -1 取消 Limit 条件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Limit</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users1</span><span class="p">).</span><span class="nf">Limit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users LIMIT 10; (users1)
</span></span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users; (users2)
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="偏移">偏移</h4>
<p>Offset，指定开始返回记录前要跳过的记录数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Offset</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users OFFSET 3;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// -1 取消 Offset 条件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Offset</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users1</span><span class="p">).</span><span class="nf">Offset</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users OFFSET 10; (users1)
</span></span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users; (users2)
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="总数">总数</h4>
<p>Count，该 model 能获取的记录总数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name = ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">).</span><span class="nf">Or</span><span class="p">(</span><span class="s">&#34;name = ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu 2&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">).</span><span class="nf">Count</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * from USERS WHERE name = &#39;jinzhu&#39; OR name = &#39;jinzhu 2&#39;; (users)
</span></span></span><span class="line"><span class="cl"><span class="c1">//// SELECT count(*) FROM users WHERE name = &#39;jinzhu&#39; OR name = &#39;jinzhu 2&#39;; (count)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{}).</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name = ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">).</span><span class="nf">Count</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT count(*) FROM users WHERE name = &#39;jinzhu&#39;; (count)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Table() 指定你要运行db操作的表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;deleted_users&#34;</span><span class="p">).</span><span class="nf">Count</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT count(*) FROM deleted_users;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;deleted_users&#34;</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;count(distinct(name))&#34;</span><span class="p">).</span><span class="nf">Count</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT count( distinct(name) ) FROM deleted_users; (count)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>注意 <code>Count</code> 必须是链式查询的最后一个操作 ，因为它会覆盖前面的 <code>SELECT</code>，但如果里面使用了 <code>count</code> 时（在查询语句中）不会覆盖</strong></p>
<h4 id="后端分页">后端分页</h4>
<p>post是文章的结构体，<code>Limit(pageSize)</code><strong>表示每次查询的最大数量</strong></p>
<p><img src="/p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/media/image-2.png"
	width="1231"
	height="495"
	srcset="/p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/media/image-2_hu4c91b7d704c21bfe7bdf4a89a6107816_175080_480x0_resize_box_3.png 480w, /p/gorm%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86/media/image-2_hu4c91b7d704c21bfe7bdf4a89a6107816_175080_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image.png"
	
	
		class="gallery-image" 
		data-flex-grow="248"
		data-flex-basis="596px"
	
></p>
<h4 id="一对多查询-预加载preload">一对多查询-预加载Preload</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="err">结构体定义</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">type</span><span class="w"> </span><span class="n">Admin</span><span class="w"> </span><span class="n">struct</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">User</span><span class="w">     </span><span class="p">[]</span><span class="k">User</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">ID</span><span class="w">       </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Username</span><span class="w"> </span><span class="n">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">AdID</span><span class="w">     </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">type</span><span class="w"> </span><span class="k">User</span><span class="w"> </span><span class="n">struct</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">UserID</span><span class="w">  </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Price</span><span class="w">   </span><span class="n">float64</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">AdminID</span><span class="w"> </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Admin</span><span class="w">   </span><span class="o">*</span><span class="n">Admin</span><span class="w"> </span><span class="o">`</span><span class="n">gorm</span><span class="p">:</span><span class="s2">&#34;ForeignKey:UserID;AssociationForeignKey:AdID&#34;</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="err">多表查询</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">admin</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">Admin</span><span class="err">{</span><span class="n">ID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">db</span><span class="p">.</span><span class="nf">Debug</span><span class="p">().</span><span class="nf">Preload</span><span class="p">(</span><span class="s2">&#34;User&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="n">admin</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">user</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="k">User</span><span class="err">{</span><span class="n">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">db</span><span class="p">.</span><span class="nf">Debug</span><span class="p">().</span><span class="nf">Preload</span><span class="p">(</span><span class="s2">&#34;Admin&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="k">user</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span><span class="w"> </span><span class="mi">22</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="mi">83</span><span class="p">.</span><span class="mi">77</span><span class="n">ms</span><span class="p">]</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">admins</span><span class="o">`</span><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">admins</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span><span class="w"> </span><span class="mi">22</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="mi">84</span><span class="p">.</span><span class="mi">80</span><span class="n">ms</span><span class="p">]</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">users</span><span class="o">`</span><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">admin_id</span><span class="o">`</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="n">Preload用于一对多查询</span><span class="err">，当查询</span><span class="n">admin表时又需要users表的数据</span><span class="err">，则可使用此方法，它不需要额外设置</span><span class="n">tag进行外键关联</span><span class="err">，但是对字段有要求，</span><span class="n">Preload方法的参数为另一个结构体的名称</span><span class="p">[</span><span class="err">要打双引号</span><span class="p">]</span><span class="err">（在</span><span class="n">admin结构体中所取的名称</span><span class="err">）。它会先查询</span><span class="n">admin表</span><span class="err">，再查询</span><span class="n">User表进行填充</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="err">主表的查询字段（主键）必须取名为</span><span class="w">  </span><span class="n">ID</span><span class="w"> </span><span class="err">，它会根据</span><span class="n">id查询到admin的数据</span><span class="err">，然后再查询</span><span class="n">User结构体所对应表中的数据</span><span class="err">，查询</span><span class="n">user表的查询字段是主表</span><span class="w">  </span><span class="o">&lt;</span><span class="err">结构体名</span><span class="n">_主表查询字段成员名</span><span class="o">&gt;</span><span class="w"> </span><span class="err">，因此</span><span class="n">user结构体中要设定AdminID成员进行关联</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="err">如果主表的查询字段不为</span><span class="n">ID时则需要用tag额外定义</span><span class="err">，来指定外键进行查询</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="o">`</span><span class="n">gorm</span><span class="p">:</span><span class="s2">&#34;ForeignKey:UserID;AssociationForeignKey:AdID&#34;</span><span class="o">`</span><span class="w"> </span><span class="p">]</span><span class="w">   </span><span class="n">ForeignKey指向当前结构体的成员名</span><span class="err">，</span><span class="n">AssociationForeignKey指向外键结构体的相对应的成员名</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="嵌套预加载preload">嵌套预加载Preload</h4>
<p>GORM 支持嵌套预加载，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">type</span><span class="w"> </span><span class="n">Admin</span><span class="w"> </span><span class="n">struct</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">ID</span><span class="w">       </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Username</span><span class="w"> </span><span class="n">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">User</span><span class="w">     </span><span class="p">[]</span><span class="k">User</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">type</span><span class="w"> </span><span class="k">User</span><span class="w"> </span><span class="n">struct</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">ID</span><span class="w">      </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Price</span><span class="w">   </span><span class="n">float64</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">AdminID</span><span class="w"> </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Student</span><span class="w"> </span><span class="n">Student</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">type</span><span class="w"> </span><span class="n">Student</span><span class="w"> </span><span class="n">struct</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Sid</span><span class="w">    </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Name</span><span class="w">   </span><span class="n">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">UserID</span><span class="w"> </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="err">一定要注意的是嵌套是</span><span class="nf">student有user的键</span><span class="p">(</span><span class="n">userid</span><span class="p">)</span><span class="err">，</span><span class="nf">user有admin的键</span><span class="p">(</span><span class="n">adminid</span><span class="p">)</span><span class="err">，层层嵌套出去的</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span><span class="w"> </span><span class="mi">23</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">55</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="mi">83</span><span class="p">.</span><span class="mi">77</span><span class="n">ms</span><span class="p">]</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">admins</span><span class="o">`</span><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">admins</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span><span class="w"> </span><span class="mi">23</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">56</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="mi">78</span><span class="p">.</span><span class="mi">89</span><span class="n">ms</span><span class="p">]</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">users</span><span class="o">`</span><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">admin_id</span><span class="o">`</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span><span class="w"> </span><span class="mi">23</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">56</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="mi">82</span><span class="p">.</span><span class="mi">81</span><span class="n">ms</span><span class="p">]</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">students</span><span class="o">`</span><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">user_id</span><span class="o">`</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Preload在使用更新updates之类时也会同时更新结构体中子结构体的数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">experts</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">created_at</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">updated_at</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">deleted_at</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">nickname</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">account</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">password</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;2020-03-21 08:10:01&#39;</span><span class="p">,</span><span class="s1">&#39;2020-03-20 00:00:00&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="s1">&#39;专家谁&#39;</span><span class="p">,</span><span class="s1">&#39;admin1&#39;</span><span class="p">,</span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">DUPLICATE</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`=`</span><span class="n">id</span><span class="o">`</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>它会使用上述insert代码，且后面会有 <code>ON DUPLICATE KEY UPDATE</code> ,**这部分语句的作用会在新增时主键或外键冲突时更新，不冲突则会新增数据。**因为在value中加入了id，当id冲突时，本来会进行更新，又因为update id=id，即id依然等于1，依然冲突。表明当冲突时不进行更新。</p>
<p>如果想更新主表的同时新增子结构体对应的表，则需要将子结构体的id变为不冲突的id。但是这样子就会出现两条除id外其他数据相同的数据，而如果要进行更新操作，则必须在 <code>ON DUPLICATE KEY UPDATE </code>后添加需要修改的字段才行，但是gorm并没有这种操作。如果要实现这种操作，可以在修改id的同时也修改子结构体的其他字段值，gorm会新增一条不同数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[SQL] ON DUPLICATE KEY UPDATE 
</span></span><span class="line"><span class="cl">id = 5,
</span></span><span class="line"><span class="cl">password = &#39;upPassword&#39;;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果想更新主表的同时不更新子结构体的表，则可以将子表进行初始化 <code>obj.Experts = pkg.Experts{}</code></p>
<h4 id="group--having">Group &amp; Having</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;orders&#34;</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;date(created_at) as date, sum(amount) as total&#34;</span><span class="p">).</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;date(created_at)&#34;</span><span class="p">).</span><span class="nf">Rows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nx">rows</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 使用Scan将多条结果扫描进事先准备好的结构体切片中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Result</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Date</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Total</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">rets</span> <span class="p">[]</span><span class="nx">Result</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;users&#34;</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;date(created_at) as date, sum(age) as total&#34;</span><span class="p">).</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;date(created_at)&#34;</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">rets</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;orders&#34;</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;date(created_at) as date, sum(amount) as total&#34;</span><span class="p">).</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;date(created_at)&#34;</span><span class="p">).</span><span class="nf">Having</span><span class="p">(</span><span class="s">&#34;sum(amount) &gt; ?&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">).</span><span class="nf">Rows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nx">rows</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Result</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Date</span>  <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Total</span> <span class="kt">int64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//Having和where类似，但是where是对原始数据进行判断，having是判断经过计算后的数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;orders&#34;</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;date(created_at) as date, sum(amount) as total&#34;</span><span class="p">).</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;date(created_at)&#34;</span><span class="p">).</span><span class="nf">Having</span><span class="p">(</span><span class="s">&#34;sum(amount) &gt; ?&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">results</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="连接">连接</h4>
<p>Joins，指定连接条件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;users&#34;</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;users.name, emails.email&#34;</span><span class="p">).</span><span class="nf">Joins</span><span class="p">(</span><span class="s">&#34;left join emails on emails.user_id = users.id&#34;</span><span class="p">).</span><span class="nf">Rows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nx">rows</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;users&#34;</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;users.name, emails.email&#34;</span><span class="p">).</span><span class="nf">Joins</span><span class="p">(</span><span class="s">&#34;left join emails on emails.user_id = users.id&#34;</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">results</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 多连接及参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Joins</span><span class="p">(</span><span class="s">&#34;JOIN emails ON emails.user_id = users.id AND emails.email = ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu@example.org&#34;</span><span class="p">).</span><span class="nf">Joins</span><span class="p">(</span><span class="s">&#34;JOIN credit_cards ON credit_cards.user_id = users.id&#34;</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;credit_cards.number = ?&#34;</span><span class="p">,</span> <span class="s">&#34;411111111111&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pluck">Pluck</h3>
<p>Pluck，查询 model 中的一个列作为切片，如果您想要查询多个列，您应该使用 <a class="link" href="https://www.liwenzhou.com/posts/Go/gorm_crud/#Scan"  target="_blank" rel="noopener"
    ><code>Scan</code></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">ages</span> <span class="p">[]</span><span class="kt">int64</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">).</span><span class="nf">Pluck</span><span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">ages</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">names</span> <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{}).</span><span class="nf">Pluck</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">names</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;deleted_users&#34;</span><span class="p">).</span><span class="nf">Pluck</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">names</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 想查询多个字段？ 这样做：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;name, age&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="扫描">扫描</h3>
<p>Scan，扫描结果至一个 struct.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Result</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Age</span>  <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">result</span> <span class="nx">Result</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;users&#34;</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;name, age&#34;</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name = ?&#34;</span><span class="p">,</span> <span class="s">&#34;Antonio&#34;</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">results</span> <span class="p">[]</span><span class="nx">Result</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;users&#34;</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;name, age&#34;</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;id &gt; ?&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">results</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 原生 SQL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Raw</span><span class="p">(</span><span class="s">&#34;SELECT name, age FROM users WHERE name = ?&#34;</span><span class="p">,</span> <span class="s">&#34;Antonio&#34;</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="链式操作相关">链式操作相关</h2>
<h3 id="链式操作">链式操作</h3>
<p>Method Chaining，Gorm 实现了链式操作接口，所以你可以把代码写成这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 创建一个查询
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">tx</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name = ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 添加更多条件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="nx">someCondition</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">tx</span> <span class="p">=</span> <span class="nx">tx</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;age = ?&#34;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">tx</span> <span class="p">=</span> <span class="nx">tx</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;age = ?&#34;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">yetAnotherCondition</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">tx</span> <span class="p">=</span> <span class="nx">tx</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;active = ?&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>在调用立即执行方法前不会生成 <code>Query</code>语句，借助这个特性你可以创建一个函数来处理一些通用逻辑。</strong></p>
<h3 id="立即执行方法">立即执行方法</h3>
<p>Immediate methods ，立即执行方法是指那些会立即生成 <code>SQL</code>语句并发送到数据库的方法, 他们一般是 <code>CRUD</code>方法，比如：</p>
<p><code>Create</code>, <code>First</code>, <code>Find</code>, <code>Take</code>, <code>Save</code>, <code>UpdateXXX</code>, <code>Delete</code>, <code>Scan</code>, <code>Row</code>, <code>Rows</code>…</p>
<p>这有一个基于上面链式方法代码的立即执行方法的例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">tx</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>生成的SQL语句如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;jinzhu&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="范围">范围</h3>
<p><code>Scopes</code>，Scope是建立在链式操作的基础之上的。</p>
<p>基于它，你可以抽取一些通用逻辑，写出更多可重用的函数库。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">AmountGreaterThan1000</span><span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span><span class="p">)</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;amount &gt; ?&#34;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">PaidWithCreditCard</span><span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span><span class="p">)</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;pay_mode_sign = ?&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">PaidWithCod</span><span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span><span class="p">)</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;pay_mode_sign = ?&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">OrderStatus</span><span class="p">(</span><span class="nx">status</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span><span class="p">)</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span><span class="p">)</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Scopes</span><span class="p">(</span><span class="nx">AmountGreaterThan1000</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;status IN (?)&#34;</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Scopes</span><span class="p">(</span><span class="nx">AmountGreaterThan1000</span><span class="p">,</span> <span class="nx">PaidWithCreditCard</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">orders</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 查找所有金额大于 1000 的信用卡订单
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Scopes</span><span class="p">(</span><span class="nx">AmountGreaterThan1000</span><span class="p">,</span> <span class="nx">PaidWithCod</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">orders</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 查找所有金额大于 1000 的 COD 订单
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Scopes</span><span class="p">(</span><span class="nx">AmountGreaterThan1000</span><span class="p">,</span> <span class="nf">OrderStatus</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;paid&#34;</span><span class="p">,</span> <span class="s">&#34;shipped&#34;</span><span class="p">})).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">orders</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 查找所有金额大于 1000 且已付款或者已发货的订单
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="多个立即执行方法">多个立即执行方法</h3>
<p>Multiple Immediate Methods，在 GORM 中使用多个立即执行方法时，后一个立即执行方法会复用前一个<strong>立即执行方法</strong>的条件 <strong>(不包括内联条件)</strong> 。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;name LIKE ?&#34;</span><span class="p">,</span> <span class="s">&#34;jinzhu%&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">,</span> <span class="s">&#34;id IN (?)&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}).</span><span class="nf">Count</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>生成的 Sql</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;jinzhu%&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;jinzhu%&#39;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="更新">更新</h2>
<h3 id="更新所有字段">更新所有字段</h3>
<p><strong><code>Save()</code>默认会根据指定的主键值查询并更新该对象的所有字段，即使你没有赋值。</strong></p>
<p><strong>如果save时没有指定主键值，或者根据主键值没有查询到数据，那么更新会变成插入新数据，这个点一定要注意</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">user</span><span class="p">.</span><span class="nx">ID</span> <span class="p">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;七米&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">user</span><span class="p">.</span><span class="nx">Age</span> <span class="p">=</span> <span class="mi">99</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Save</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">////  UPDATE `users` SET `created_at` = &#39;2020-02-16 12:52:20&#39;, `updated_at` = &#39;2020-02-16 12:54:55&#39;, `deleted_at` = NULL, `name` = &#39;七米&#39;, `age` = 99, `active` = true  WHERE `users`.`deleted_at` IS NULL AND `users`.`id` = 1
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="更新修改字段">更新修改字段</h3>
<p>如果你只希望更新指定字段，可以使用 <code>Update</code>(更新单个字段)或者 <code>Updates</code>(更新多个字段)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 更新单个属性，如果它有变化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Update</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;hello&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET name=&#39;hello&#39;, updated_at=&#39;2013-11-17 21:34:10&#39; WHERE id=111;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 根据给定的条件更新单个属性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;active = ?&#34;</span><span class="p">,</span> <span class="kc">true</span><span class="p">).</span><span class="nf">Update</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;hello&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET name=&#39;hello&#39;, updated_at=&#39;2013-11-17 21:34:10&#39; WHERE id=111 AND active=true;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 使用 map 更新多个属性，只会更新其中有变化的属性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Updates</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;age&#34;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET name=&#39;hello&#39;, age=18, active=false, updated_at=&#39;2013-11-17 21:34:10&#39; WHERE id=111;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 使用 struct 更新多个属性，只会更新其中有变化且为非零值的字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Updates</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">18</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET name=&#39;hello&#39;, age=18, updated_at = &#39;2013-11-17 21:34:10&#39; WHERE id = 111;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 警告：当使用 struct 更新时，GORM只会更新那些非零值的字段
</span></span></span><span class="line"><span class="cl"><span class="c1">// 对于下面的操作，不会发生任何更新，&#34;&#34;, 0, false 都是其类型的零值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Updates</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Active</span><span class="p">:</span> <span class="kc">false</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="更新选定字段">更新选定字段</h3>
<p>如果你想更新或忽略某些字段，你可以使用 <code>Select</code>，<code>Omit</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">).</span><span class="nf">Updates</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;age&#34;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET name=&#39;hello&#39;, updated_at=&#39;2013-11-17 21:34:10&#39; WHERE id=111;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Omit</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">).</span><span class="nf">Updates</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;age&#34;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET age=18, active=false, updated_at=&#39;2013-11-17 21:34:10&#39; WHERE id=111;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="无hooks更新指定单一或多个字段更新不更新钩子函数">无Hooks更新(指定单一或多个字段更新，不更新钩子函数)</h3>
<p>上面的更新操作会自动运行 model 的 <code>BeforeUpdate</code>, <code>AfterUpdate</code> 方法，更新 <code>UpdatedAt</code> 时间戳, 在更新时保存其 <code>Associations</code>, 如果你不想调用这些方法，你可以使用 <code>UpdateColumn</code>， <code>UpdateColumns</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 更新单个属性，类似于 `Update`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">UpdateColumn</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;hello&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET name=&#39;hello&#39; WHERE id = 111;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 更新多个属性，类似于 `Updates`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">UpdateColumns</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">18</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET name=&#39;hello&#39;, age=18 WHERE id = 111;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="批量更新">批量更新</h3>
<p>批量更新时 <code>Hooks（钩子函数）</code>不会运行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Table</span><span class="p">(</span><span class="s">&#34;users&#34;</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;id IN (?)&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">}).</span><span class="nf">Updates</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;age&#34;</span><span class="p">:</span> <span class="mi">18</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET name=&#39;hello&#39;, age=18 WHERE id IN (10, 11);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 使用 struct 更新时，只会更新非零值字段，若想更新所有字段，请使用map[string]interface{}，map可以将零值携带进数据库
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{}).</span><span class="nf">Updates</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">18</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET name=&#39;hello&#39;, age=18;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 使用 `RowsAffected` 获取当前操作更新影响的行数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{}).</span><span class="nf">Updates</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">18</span><span class="p">}).</span><span class="nx">RowsAffected</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="使用sql表达式更新">使用SQL表达式更新</h3>
<p>先查询表中的第一条数据保存至user变量。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">user</span> <span class="nx">User</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Update</span><span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">,</span> <span class="nx">gorm</span><span class="p">.</span><span class="nf">Expr</span><span class="p">(</span><span class="s">&#34;age * ? + ?&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE `users` SET `age` = age * 2 + 100, `updated_at` = &#39;2020-02-16 13:10:20&#39;  WHERE `users`.`id` = 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Updates</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&#34;age&#34;</span><span class="p">:</span> <span class="nx">gorm</span><span class="p">.</span><span class="nf">Expr</span><span class="p">(</span><span class="s">&#34;age * ? + ?&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE &#34;users&#34; SET &#34;age&#34; = age * &#39;2&#39; + &#39;100&#39;, &#34;updated_at&#34; = &#39;2020-02-16 13:05:51&#39; WHERE `users`.`id` = 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">UpdateColumn</span><span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">,</span> <span class="nx">gorm</span><span class="p">.</span><span class="nf">Expr</span><span class="p">(</span><span class="s">&#34;age - ?&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE &#34;users&#34; SET &#34;age&#34; = age - 1 WHERE &#34;id&#34; = &#39;1&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;age &gt; 10&#34;</span><span class="p">).</span><span class="nf">UpdateColumn</span><span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">,</span> <span class="nx">gorm</span><span class="p">.</span><span class="nf">Expr</span><span class="p">(</span><span class="s">&#34;age - ?&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE &#34;users&#34; SET &#34;age&#34; = age - 1 WHERE &#34;id&#34; = &#39;1&#39; AND age &gt; 10;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="修改hooks中的值">修改Hooks中的值</h3>
<p>如果你想修改 <code>BeforeUpdate</code>, <code>BeforeSave</code> 等 Hooks 中更新的值，你可以使用 <code>scope.SetColumn</code>, 例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">//加密明文，用于用户密码设置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">user</span> <span class="o">*</span><span class="nx">User</span><span class="p">)</span> <span class="nf">BeforeSave</span><span class="p">(</span><span class="nx">scope</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">Scope</span><span class="p">)</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="c1">//GenerateFromPassword: 将明文密码加密，然后通过SetColumn存入数据库
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="nx">pw</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">bcrypt</span><span class="p">.</span><span class="nf">GenerateFromPassword</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">Password</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">scope</span><span class="p">.</span><span class="nf">SetColumn</span><span class="p">(</span><span class="s">&#34;EncryptedPassword&#34;</span><span class="p">,</span> <span class="nx">pw</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="其它更新选项针对sql-server">其它更新选项(针对SQL Server)</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 为 update SQL 添加其它的 SQL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;gorm:update_option&#34;</span><span class="p">,</span> <span class="s">&#34;OPTION (OPTIMIZE FOR UNKNOWN)&#34;</span><span class="p">).</span><span class="nf">Update</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;hello&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET name=&#39;hello&#39;, updated_at = &#39;2013-11-17 21:34:10&#39; WHERE id=111 OPTION (OPTIMIZE FOR UNKNOWN);
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="删除">删除</h2>
<h3 id="删除记录只针对通过id主键进行删除">删除记录（只针对通过ID主键进行删除）</h3>
<p><strong>警告</strong> ：<strong>删除记录时，请确保主键字段有值，GORM 会通过主键去删除记录，如果主键为空，GORM 会删除该 model 的所有记录（表中所有数据都会被删除！！！）。</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 删除现有记录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">email</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// DELETE from emails where id=10;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 为删除 SQL 添加额外的 SQL 操作
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;gorm:delete_option&#34;</span><span class="p">,</span> <span class="s">&#34;OPTION (OPTIMIZE FOR UNKNOWN)&#34;</span><span class="p">).</span><span class="nf">Delete</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">email</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// DELETE from emails where id=10 OPTION (OPTIMIZE FOR UNKNOWN);
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="批量删除">批量删除</h3>
<p>删除全部匹配的记录</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;email LIKE ?&#34;</span><span class="p">,</span> <span class="s">&#34;%jinzhu%&#34;</span><span class="p">).</span><span class="nf">Delete</span><span class="p">(</span><span class="nx">Email</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// DELETE from emails where email LIKE &#34;%jinzhu%&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="nx">Email</span><span class="p">{},</span> <span class="s">&#34;email LIKE ?&#34;</span><span class="p">,</span> <span class="s">&#34;%jinzhu%&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// DELETE from emails where email LIKE &#34;%jinzhu%&#34;;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="软删除当没有使用gormmodel构建结构体时删除直接就是物理删除">软删除（当没有使用gorm.Model构建结构体时，删除直接就是物理删除）</h3>
<p>如果一个 model 有 <code>DeletedAt</code> 字段，他将自动获得软删除的功能！ 当调用 <code>Delete</code> 方法时， 记录不会真正的从数据库中被删除， 只会将 <code>DeletedAt</code> 字段的值会被设置为当前时间</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET deleted_at=&#34;2013-10-29 10:23&#34; WHERE id = 111;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 批量删除
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;age = ?&#34;</span><span class="p">,</span> <span class="mi">20</span><span class="p">).</span><span class="nf">Delete</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// UPDATE users SET deleted_at=&#34;2013-10-29 10:23&#34; WHERE age = 20;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 查询记录时会忽略被软删除的记录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;age = 20&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE age = 20 AND deleted_at IS NULL;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Unscoped 方法可以查询被软删除的记录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Unscoped</span><span class="p">().</span><span class="nf">Where</span><span class="p">(</span><span class="s">&#34;age = 20&#34;</span><span class="p">).</span><span class="nf">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// SELECT * FROM users WHERE age = 20;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="物理删除用gormmodel构建结构体时">物理删除（用gorm.Model构建结构体时）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Unscoped 方法可以物理删除记录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nf">Unscoped</span><span class="p">().</span><span class="nf">Delete</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">order</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//// DELETE FROM orders WHERE id=10;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>DB.Where().Find().RecordNotFound()</code>判断查询结果是否存在</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2022 - 
        
        2023 笑傩
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Long+Cang&family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@300&family=Noto+Serif+SC:wght@300&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">

    </body>
</html>
